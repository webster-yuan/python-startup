下面内容会分 4 层，你在面试时**按时间和对方反应选层级**。

---

# 一、3 分钟【主线版】——一定要先讲清楚的版本

> **适合面试官问：你做过什么鉴权 / 权限相关的项目？**

### 标准讲法（几乎可以照读）

> 我参与过公司接口鉴权体系的改造。
> 整体采用的是**集中式授权架构**：
> 业务服务基于 FastAPI，本身不维护用户、角色和权限关系，而是通过一个自研的 Python SDK，在接口层声明所需权限码。
> SDK 会从请求中提取登录后的 sid，然后通过 RPC 调用中台的 user-auth 服务，获取该用户的权限集合，并在本地完成权限匹配，未授权请求直接返回
> 403。
> 权限来源由中台 portal 系统统一配置，基于用户-角色-权限模型，权限与前端页面操作和接口一一对应。

**讲完这段，先停。**
90% 的面试官会继续追问。

---

# 二、5–8 分钟【展开版】——面试官开始感兴趣

> **适合追问：能具体讲讲流程吗？**

### 你可以顺着这个结构讲（非常稳）

#### 1️⃣ 权限是怎么定义的？

> 权限是从前端左侧目录树抽象出来的，每个页面操作对应一个权限码，比如 `a_view`、`a_edit`。
> 角色在 portal 系统里配置能拥有哪些权限，用户创建时关联角色，最终存储在 PostgreSQL。

#### 2️⃣ 接口是怎么声明权限的？

> 在 FastAPI 中，我们通过依赖注入或中间件的方式，在接口定义时声明所需权限码，这样权限规则靠近接口本身，业务代码不需要感知用户和角色细节。

#### 3️⃣ 请求进来后发生了什么？

> 请求进入后，SDK 会提取请求里的 sid 和接口所需权限，通过 RPC 调用 user-auth 服务。
> user-auth 根据 sid 查询用户、角色和权限，返回权限码数组，SDK 在本地做 ANY 匹配，匹配成功就放行，否则直接返回 403。

---

# 三、面试官高频追问 & 标准回答（核心加分区）

下面是**你一定会被问到的**，我直接给你“能打”的答案。

---

## Q1：你们这算 OAuth2 吗？

### 回答（高级、但不装）

> 我们没有完整实现 OAuth2 的授权码流程，但整体架构是符合 OAuth2 的 Resource Server 模型的。
> sid 在语义上等价于 access_token，接口的权限码等价于 scope。
> 不同的是我们没有把权限写进 token，而是通过独立的 user-auth 服务在请求时进行授权决策，这样权限变更可以即时生效。

---

## Q2：为什么不用 JWT，直接本地校验？

### 回答（体现架构取舍）

> JWT 本地校验性能更好，但权限变更不实时。
> 我们的场景更偏向权限集中管理和即时生效，所以选择运行时通过 user-auth 判定。
> 这是用性能换一致性和管控能力的取舍。

---

## Q3：Postman 测试接口为什么要带 Cookie 和 Authorization？

### 回答（非常专业）

> 浏览器登录后会自动携带 Cookie 和 Authorization 头，而 Postman 是独立客户端，需要手动模拟已登录态。
> 如果不带这些凭证，请求会在鉴权层直接被拦截返回 403，甚至不会进入 FastAPI 业务逻辑。

---

## Q4：为什么请求“进不了 FastAPI”？

### 回答（中高级分水岭）

> 因为鉴权是在业务逻辑之前完成的，可能是在 SDK 中间件、网关或统一鉴权层，未通过校验的请求会被提前拒绝，这是为了避免未授权请求进入业务系统。

---

## Q5：你在这个项目中具体负责什么？

### 回答（非常重要，别抢中台功劳）

> 我主要负责业务侧的接口鉴权改造，包括 FastAPI 接口层权限声明、鉴权 SDK 的接入方式设计，以及与中台 user-auth 的 RPC 协议协作。
> 权限模型和策略管理由中台负责。

---

## Q6：这个系统的瓶颈或风险点是什么？

### 回答（架构视角）

> 主要是 user-auth 成为关键依赖，需要做好缓存、超时和降级策略。
> 在高并发场景下也要注意 RPC 性能，否则会影响接口响应时间。

---

# 四、哪些点你要“主动讲”，哪些要“避开”

## ✅ 主动讲（加分）

* 集中式授权
* 接口层声明权限
* sid ≈ access_token
* 权限即时生效
* 关注点分离

## ⚠️ 少讲 / 不讲（除非被问）

* user-auth 内部表结构
* 具体 SQL
* 太多前端细节
* “我们就是这么做的，没有为什么”

---

# 五、给你一个“收尾句”（非常好用）

当你感觉对方差不多听明白了，可以这样收：

> 这个项目让我比较系统地理解了企业里认证和授权是如何解耦的，也让我对 OAuth2 的 Resource Server 模型有了更实际的理解。

---

---

## 🎯 30 秒自我介绍 · 鉴权亮点版（推荐）

> 我在公司参与过一次接口鉴权体系的改造。
> 业务服务是基于 FastAPI 的，我们没有在业务侧维护用户和权限，而是通过自研的 Python 鉴权 SDK，在接口层声明所需权限。
> 请求进来后，SDK 会从请求中提取 sid，通过 RPC 调用中台的 user-auth 服务获取用户权限集合，并在本地完成权限匹配，未授权请求会在业务逻辑前直接返回
> 403。
> 这套方案实现了权限的集中管理和即时生效，我也因此对 OAuth2 的 Resource Server 和授权模型有了比较实际的理解。

**讲完直接停，不要补。**
面试官 80% 会接着问👇

* “你们为什么不用 JWT？”
* “这个和 OAuth2 是什么关系？”
* “你在里面具体负责哪一块？”

👉 **这些你现在全部都能稳接。**

---

## 🧠 如果面试官打断你（超短兜底版｜15 秒）

> 我主要做的是业务侧接口鉴权改造，FastAPI 通过 SDK 声明接口权限，运行时调用中台鉴权服务判定是否放行，权限统一由中台管理。

---

## 🚫 常见错误（你现在可以完全避开）

❌「我做过 OAuth2 登录」
❌「我负责公司统一鉴权系统设计」
❌「就是用 token 鉴权」

你现在的讲法是：
✅ **讲“体系”**
✅ **讲“边界”**
✅ **讲“取舍”**

---

## 🏁 最后一句真心评价你现在的状态

你现在已经不是：

> “我工作一年，对 OAuth2 不太了解”

而是：

> **“我做过一套企业级鉴权体系，只是之前不知道它在安全体系里叫什么”**

这在面试里是**实打实的优势**。

如果你后面：

* 想投 **Python / FastAPI / 后端**
* 或想往 **偏系统 / 架构理解** 走

这套内容都能反复用。


