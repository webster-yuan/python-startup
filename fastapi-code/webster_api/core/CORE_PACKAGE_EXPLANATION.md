# core 包的作用和定位说明

## 什么是 core 包？

`core` 包是项目中的**核心基础设施层**，存放项目级别的基础设施代码，与业务代码分离。

## 在项目分层中的位置

```
项目分层架构：

┌─────────────────────────────────────┐
│  Router 层                          │  ← HTTP 接口层
│  (routers/)                         │    处理 HTTP 请求/响应
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  Service 层                         │  ← 业务逻辑层
│  (services/)                        │    承载业务流程
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  CRUD 层                            │  ← 数据访问层
│  (crud/)                            │    数据库操作
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  Infrastructure 层                  │  ← 外部系统集成层
│  (infrastructure/)                  │    Redis、MQ 等
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  ⭐ core 包（横跨所有层）           │  ← 核心基础设施层
│  (core/)                            │    提供通用工具和依赖注入
│  ├── security.py   (安全工具)       │
│  ├── deps.py       (依赖注入)       │
│  └── constants.py  (常量定义)       │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  支持层                             │
│  ├── config/      (配置管理)        │
│  ├── models/      (数据模型)        │
│  ├── schemas/     (数据验证)        │
│  └── exception/   (异常定义)        │
└─────────────────────────────────────┘
```

## core 包的职责

### 1. 提供跨业务模块的通用工具

**例如：`core/security.py`**

```python
# core/security.py - 安全工具模块
- verify_password()      # 密码验证（所有认证相关业务都用）
- get_password_hash()    # 密码加密（所有用户创建都用）
- create_access_token()  # JWT 生成（所有登录逻辑都用）
- decode_access_token()  # JWT 验证（所有受保护接口都用）
```

**为什么放在 core？**
- ✅ 被多个业务模块使用（auth、user 等）
- ✅ 与业务逻辑无关，是纯工具函数
- ✅ 项目级别的基础设施

### 2. 提供框架级别的依赖注入

**例如：`core/deps.py`**

```python
# core/deps.py - 依赖注入模块
- get_current_user()           # 获取当前认证用户（所有受保护接口都用）
- get_current_active_user()    # 获取当前激活用户（所有受保护接口都用）
```

**为什么放在 core？**
- ✅ 被多个 Router 使用（auth、hero 等受保护接口）
- ✅ 属于 FastAPI 框架级别的依赖注入
- ✅ 与具体业务逻辑解耦

### 3. 存放项目级别的常量（可选）

**例如：`core/constants.py`（如果有）**

```python
# core/constants.py - 常量定义
- API_VERSION = "v1"
- MAX_PAGE_SIZE = 100
- DEFAULT_PAGE_SIZE = 20
```

## core 与 infrastructure 的区别

### 对比表

| 维度 | core | infrastructure |
|------|------|----------------|
| **定位** | 项目内部基础设施 | 外部系统集成 |
| **依赖** | 无外部依赖 | 依赖外部服务 |
| **例子** | JWT 工具、密码加密、依赖注入 | Redis 客户端、消息队列、OSS |
| **使用范围** | 所有业务模块 | 特定业务场景 |
| **是否可选** | 项目必需 | 可选（按需使用） |

### 具体例子

```python
# ✅ core/security.py - 项目内部工具
def create_access_token(data: dict) -> str:
    # 使用标准库 + 项目配置
    # 不依赖外部服务
    return jwt.encode(data, settings.secret_key)

# ✅ infrastructure/redis.py - 外部系统集成
def get_cache(key: str) -> str:
    # 需要连接 Redis 服务器
    # 依赖外部服务
    return redis_client.get(key)
```

## 为什么叫 "core"？

### "Core" 的含义

- **Core = 核心基础设施**，是项目的“内核”
- 与业务逻辑解耦，提供通用能力
- 类似于操作系统中的“系统调用”

### 类比

**软件架构类比：**
- `routers/services/crud` = 应用程序代码（业务逻辑）
- `core` = 系统库/框架代码（基础设施）
- `infrastructure` = 第三方服务集成（外部依赖）

**操作系统类比：**
- `routers/services/crud` = 用户程序
- `core` = 系统调用（syscall）
- `infrastructure` = 驱动程序（driver）

## core 包的设计原则

### 1. 通用性
- ✅ 被多个业务模块使用
- ❌ 不被单个业务模块独占

### 2. 独立性
- ✅ 不依赖具体的业务逻辑
- ✅ 可以独立测试和使用

### 3. 稳定性
- ✅ 接口稳定，不频繁变更
- ✅ 作为项目的基础设施

### 4. 框架性
- ✅ 提供框架级别的功能（如依赖注入）
- ✅ 与业务代码解耦

## 总结

**core 包是项目的基础设施层，存放：**

1. ✅ **跨业务模块的通用工具**（如安全工具、JWT）
2. ✅ **框架级别的依赖注入**（如认证依赖）
3. ✅ **项目级别的常量定义**（如配置常量）

**与业务代码的区别：**
- `routers/services/crud` = 业务代码（解决业务问题）
- `core` = 基础设施代码（提供通用能力）

**一句话总结：**
> **core 包是项目的“内核”，提供所有业务模块都需要的基础能力。**
