### **词法作用域的解释与示例**

在 Python 中，词法作用域（Lexical Scope）指的是变量的作用范围是基于程序的静态文本结构决定的，而不是运行时动态决定的。这一特性允许嵌套函数访问其外层函数定义的变量，但对这些变量赋值时会受到限制。

以下是逐条规则的解析和示例：

---

### **1. 嵌套函数可以引用外层函数的变量**

#### **规则**：
嵌套函数可以访问外层函数作用域中定义的变量，但不能直接对这些变量重新赋值。

#### **示例代码**：
```python
def outer():
    x = 10

    def inner():
        # 可以引用外层变量
        print(f"Outer variable x: {x}")

    inner()

outer()
```

**输出**：
```
Outer variable x: 10
```

在这里，`inner` 函数通过词法作用域引用了 `outer` 函数中的变量 `x`。

---

### **2. 不能对外层函数的变量赋值**

#### **规则**：
对外层作用域中的变量进行赋值会被 Python 视为对局部变量的赋值。即使变量在外层定义，赋值操作也会导致该变量在当前作用域中被认为是局部变量。

#### **示例代码**：
```python
def outer():
    x = 10

    def inner():
        # 尝试修改外层变量
        x = 20  # 会导致 Python 将 x 视为 inner 的局部变量
        print(f"Inner x: {x}")

    inner()
    print(f"Outer x: {x}")

outer()
```

**输出**：
```
Inner x: 20
Outer x: 10
```

这里，`inner` 函数的 `x` 被认为是局部变量，与外层的 `x` 无关。

---

### **3. 使用 `global` 声明全局变量**

#### **规则**：
如果在函数内部使用 `global` 声明一个变量，则该变量被视为全局变量，并且可以在函数中修改。

#### **示例代码**：
```python
x = 10

def modify_global():
    global x  # 声明使用全局变量
    x = 20

modify_global()
print(f"Global x: {x}")
```

**输出**：
```
Global x: 20
```

`global` 声明使得函数可以直接修改全局作用域中的变量。

---

### **4. 使用 `nonlocal` 声明外层作用域变量**

#### **规则**：
如果想在嵌套函数中对外层函数的变量赋值，可以使用 `nonlocal` 关键字。

#### **示例代码**：
```python
def outer():
    x = 10

    def inner():
        nonlocal x  # 声明使用外层函数的变量
        x = 20
        print(f"Inner x: {x}")

    inner()
    print(f"Outer x: {x}")

outer()
```

**输出**：
```
Inner x: 20
Outer x: 20
```

`nonlocal` 声明使得嵌套函数能够修改外层函数的局部变量。

---

### **5. 示例代码分析**

#### **规则应用**：
以下是一个使用词法作用域的实际例子：

```python
def get_adder(summand1):
    """返回一个将数字加到指定值的函数"""
    def adder(summand2):
        return summand1 + summand2  # 引用外层函数变量 summand1

    return adder
```

#### **解释**：
- `adder` 是一个嵌套函数。
- 它通过词法作用域访问 `get_adder` 函数中的 `summand1`，并将其与 `summand2` 相加。

#### **调用示例**：
```python
add_five = get_adder(5)
print(add_five(10))  # 输出 15

add_ten = get_adder(10)
print(add_ten(3))  # 输出 13
```

---

### **6. 总结规则与关键点**

| **规则**                          | **示例**                                                                                   | **说明**                                                                                |
|-----------------------------------|-------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
| 嵌套函数可以引用外层变量            | `def inner(): print(x)`                                                                    | 外层变量 `x` 在嵌套函数中可用。                                                       |
| 不能直接对外层变量赋值              | `def inner(): x = 20`                                                                     | 此赋值会导致 `x` 被视为局部变量，与外层变量无关。                                      |
| 使用 `global` 修改全局变量         | `global x; x = 20`                                                                        | 显式声明全局变量，允许修改全局作用域中的 `x`。                                         |
| 使用 `nonlocal` 修改外层变量       | `nonlocal x; x = 20`                                                                      | 显式声明修改外层函数的局部变量。                                                      |
| Python 的作用域基于静态文本决定    | `def adder(summand2): return summand1 + summand2`                                         | 嵌套函数引用的是外层函数定义时的作用域，而不是运行时的动态上下文。                      |

**规则强制性**：必须理解并遵守 Python 的词法作用域规则，以避免不必要的错误和代码混乱。