### **异常处理规范与示例**

以下是关于异常处理的具体规范和代码示例：

---

### **1. 避免使用 `except:` 或捕获所有异常【强制】**

- **规则**：不要使用空的 `except:` 或 `except Exception:` 捕获所有异常，除非：
  - 当前逻辑处于最外层。
  - 捕获到异常后，重新触发该异常。

**原因**：
- 捕获所有异常会隐藏真正的错误，增加排查难度。
- `SystemExit` 和 `KeyboardInterrupt` 等异常可能被误捕获，导致程序无法正常退出。

**示例**：

**正确写法**：
```python
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"捕获到异常：{e}")
    raise  # 重新抛出异常，交给更高层逻辑处理
```

**错误写法**：
```python
try:
    result = 10 / 0
except:  # 空的 except
    print("捕获到未知异常，但具体原因不明")
```

---

### **2. 减少 `try/except` 块中的代码量【建议】**

- **规则**：尽量将 `try` 块缩小到只包含可能抛出异常的代码，避免隐藏不相关代码的错误。

**示例**：

**正确写法**：
```python
try:
    result = process_data(data)  # 仅捕获此处的异常
except ValueError as e:
    print(f"处理数据时发生错误：{e}")
else:
    print("数据处理成功")
```

**错误写法**：
```python
try:
    result = process_data(data)
    log_result(result)  # 不相关代码可能抛出意外异常
    save_to_database(result)
except ValueError as e:
    print(f"处理数据时发生错误：{e}")
```

---

### **3. 外部数据读取时，增加 `try/except` 防止程序异常退出【强制】**

**示例**：

```python
def read_file(file_path):
    try:
        with open(file_path, 'r') as file:
            data = file.read()
        return data
    except FileNotFoundError:
        print("文件未找到，请检查路径")
    except PermissionError:
        print("没有权限访问该文件")
```

---

### **4. 使用基于对象的异常【强制】**

- 异常必须继承自 `Exception` 或其子类，而非直接使用字符串。

**示例**：

**正确写法**：
```python
class CustomError(Exception):
    pass

raise CustomError("自定义异常")
```

**错误写法**：
```python
raise "这是一个错误"  # 字符串形式异常（过时）
```

---

### **5. 模块或包应定义自己的异常基类【强制】**

- 自定义异常基类继承自内置 `Exception`，其他模块异常继承此基类。

**示例**：
```python
class MyModuleError(Exception):
    """模块通用异常基类"""
    pass

class InvalidInputError(MyModuleError):
    """输入无效异常"""
    pass

try:
    raise InvalidInputError("输入数据格式错误")
except MyModuleError as e:
    print(f"捕获模块异常：{e}")
```

---

### **6. 使用 `raise Exception("message")` 代替旧的 `raise Exception, "message"`【强制】**

- 新的语法更易读，且支持多行字符串。

**示例**：

**正确写法**：
```python
raise ValueError("参数无效：必须为正整数")
```

**错误写法**：
```python
raise ValueError, "参数无效：必须为正整数"  # 旧语法
```

---

### **7. 禁止空的 `except:` 不做任何处理【强制】**

- 未处理异常会隐藏真正的错误，且会捕获 `SystemExit` 和 `KeyboardInterrupt`。

**示例**：

**正确写法**：
```python
try:
    result = int(input("请输入整数："))
except ValueError as e:
    print(f"输入无效：{e}")
    raise
```

**错误写法**：
```python
try:
    result = int(input("请输入整数："))
except:
    pass  # 不处理异常，程序将继续运行但数据可能出错
```

---

### **8. 自定义异常不使用两个参数或字符串异常【强制】**

- **规则**：禁止使用 `raise MyException, "Error message"` 或 `raise "Error message"`。
- 应改用标准的异常构造方式。

**示例**：

**正确写法**：
```python
class MyException(Exception):
    pass

raise MyException("错误信息")
```

**错误写法**：
```python
raise MyException, "错误信息"  # 旧语法
raise "错误信息"  # 字符串异常（过时）
```

---

### **9. 异常在同级 `try/except` 中无法捕获【强制】**

- **规则**：`raise` 的异常总是向上层传播，不会被同级捕获。

**示例**：

**正确写法**：
```python
try:
    raise ValueError("无效的值")
except ValueError:
    print("捕获到 ValueError")
finally:
    print("执行清理操作")
```

**错误示例**：
```python
try:
    try:
        raise ValueError("无效的值")
    except NotExist:
        raise ValueError("捕获不到这里的 ValueError")  # 无法捕获
    except ValueError:
        print("这里也捕获不到")
```

---

### **10. 捕获多个异常【强制】**

- 捕获多个异常时，必须使用括号。

**示例**：

**正确写法**：
```python
try:
    result = int(input("请输入一个整数："))
except (ValueError, TypeError) as e:
    print(f"捕获到异常：{e}")
```

**错误写法**：
```python
try:
    result = int(input("请输入一个整数："))
except ValueError, TypeError:  # 旧语法
    print("捕获到异常")
```

---

### **总结规范**

| **规则编号** | **内容**                                                             |
|--------------|----------------------------------------------------------------------|
| **1**        | 禁止使用空的 `except:` 捕获所有异常，除非是最外层逻辑并重新抛出。            |
| **2**        | `try/except` 块尽量小，减少隐藏的错误范围。                              |
| **3**        | 外部数据读取增加异常处理，防止程序退出。                                    |
| **4**        | 使用继承自 `Exception` 的对象进行异常处理。                                 |
| **5**        | 定义模块异常基类，便于统一管理和分类异常。                                    |
| **6**        | 使用 `raise Exception("message")` 代替旧语法。                             |
| **7**        | 禁止空 `except:` 不做任何处理。                                            |
| **8**        | 自定义异常禁止使用两个参数或字符串形式。                                      |
| **9**        | 同级 `try/except` 无法捕获 `raise` 的异常。                                  |
| **10**       | 捕获多个异常时必须用括号 `(Exception1, Exception2)`。                        |

通过这些规范，可以确保异常处理逻辑清晰、安全，并且便于维护和扩展。